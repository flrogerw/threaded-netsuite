#!/usr/bin/php
<?php 

require_once( __DIR__ . DIRECTORY_SEPARATOR . 'Configure.php' );

try{


$xxx= 'nx3arHBVbhV2elo6n7cdf46hqZw+di9SKB7KIWI/3fIcHnt2nct1bT4rX2uvEPpzlV7Agzj9Zgv+QB8Ir7mPBu1gCbbgeV+r7Tc9xy4uXRUYAAwIkNvd7bEb4jIzQnUWfA3L+OofUBdog7gwGnhtANL6njySGchuN3Fg9NfABmGht9L/cM9EQV4vz/HmO+qyDHVm4LBvJT4zqXUXw9d+HCUIS+jfKnIyA3l7Ghean8mFa0DEcLe4Dd06UUkUogoDUCtHtYaNFSd6mHaTQVL1un2/0IBJsswCfDWp/s2oI0t6tHOvlku5L6gT5ilv1HSR54IZprJUt0xeYH9idcdVeMM+O+M4LzQGmkeM/i+0OXn/AhBBZcgu71MOhYjZ1TM2i0XjHicTJph01RE98MD6bM37MYev4FoftZVEz4PZoT82sBc6HDMgyld3ncI6svi05Sc0lnAW6YF6Zlv94q7hLyQlJ98C5vzLEnDJ+shPEZ/+5xiPdohyi00/xDfoShCsgl+MlmZjPlVKLgYk+HXFkmI2wWvO7zWv2neUlsuJMcAoWwGJEyWQsQHctECkuk6OV62GtOynblVUnt4Y7t8KyoiO6NJgMOKS7cCMdrMLsn7SRR10I/HTOwVcx9+qjxY7zMUdvpg3GjbHgHysKndbZLhVLIPBvBiBkcS1ZRFy4mNRHnsRqKLNnpPQsDwoY21XeIImZSrOUWx6H3/LTxtABnKjyAOg6Zhn7M43GAujXBCA/Ch6SThnBeIJmgvH5+SBWU+TBWE8wtzRXKixcExw7nMeowCmxT+7g4Gw0CRJHSz6lRBfZ6JufqUiQm0TRSxfoFEsj91o2f6y48jw3tPlpcGZl8DvDF52Uhobgc3l/VtvXPUWdSy4Bb++eqBM5Vjrk3ZL9QELmBa4zfCg2Ub+u+VjYqhM+Ogq2uNVp2ZL+CAbApux1Um9IZDY0tWZdHkSD/G7+WYA/8V4w5gmzoT2lT0qbxqOMcBoJS+3qVJJUoOB/N7PjsfU5xA8Tnq7ifo995YyFUKJC2FV5ZPyiW/D+STEKF/Z1nFJOjQPU2IIMr81ogXxssOkrH34GWGY8PxcrOa6HoTYbG6WlcMuDQLczflHSPh03jIKkem4KAzJUXJCQvSZxYri4dlDCF0Whp8WgDXJpFHQljrhKPVIxv0VZFUODBjDeLBBxgQiEvxB2XXEC5yOYt1fhWOsYMIfDUgPtEN+gQrfvDOk4Zltz34Qo/VC5OdWJHsfmP34qHudzIDOfmjQXhvJir53OjwIcXGros+1aH5TcvM1fKTJlIy8JRMuWvYnGdRK3iTYJgp3AOTlvPtxeVdRwGKFJV6m4gkY+JF3sUgjprQLrrSi4nhIshxrKodVcj51o7FFpCPjB97A6wr858e9dHw5xZx/XtZGcGkk7vOOOYVeaGPVvZHJCXIfwCeKp2JvNEBChfPqd2aAKzp99CKge4kYMi0Tl4blKHrpQc1maFJk/ICxepUo0BBVSX6vtnH4G9rjwO+1aMipbkx/oK+pzHIXMCSI0Ftb/NWIWwrCxnQREovUYf9QAzYdjPqJmi5QaKjZ/q7t0uRzGhHr4rPRF6qVfVIIcCUCBvpa9HZ0sGnjOLU+ChjnM0sh8yh1wXn3v21OaxAPUwjL7lisblM52dbwK6HlDMokPX35/KFPa3gEte4WwGk1TbN6jLumMHngjmbtj+C/31fEKRb/82e96ovpZCNYgWLkoqRJ8d2ofskgzPk6jWibV1OEL4w9q+bPRRrzJgSwPpcw622qljoyoZJHq5lIemGL7gIwLprHn/fBQl46NysOtcxn5BlRlwYuqNDPizobUsAZdAl/WSQt13KqsNLwAIupMDFVwuy56W2oZikTHv25BEYgtVNtmPimG8vSf7RsJs62Ts/4zFStALL+0t1ugn4Q+S7CMtmqDv2o11cDZAnuoknXuzG4ovmwJ6hGdTFq4pMl4/5gMNTwTMbvHdgQCn0/VdEiXyYl88k4WQwg3/KRJMAD+X2fv0UuQdbU4Qpc/CWFguXxDsZ66/9pPa0JA3Mc9P//1PXT+J3HrVn+AHC/Z0wUc5ApGCBOTw+XUXcKgSPEK5cbtRunSdnb79jvNwdn0fUuLMYyIF1cTEieAb15p+DQbq61vm1bRrdXzXjv9sdZhz3ux3XfDvU10t8kWAMc9KkiV1sIHClPAY3K+srZzb73J6naRCijNBhIbYdM0vGLry6IgxlWpf91MGXRKXMpPJ5pGhL85jeMMIyqu4ybfS+I9fJSkQ39E+rtRhJOp1U=';
echo(  decrypt(   $xxx  ) );
	die();

	/** FIXES
	 Removed:
	 Backslashes from dates
	 "_itemlocation":"corporate"

	*/

	//Use GC
	//$sJson = '{"order":{"_source":"Fotobar Store 2","giftcertificateitem":[{"giftcertcode":"store405"}],"location":2,"department":2,"leadsource":2,"custbody_order_source":28,"ccprocessor":1,"custbody_order_source_id":"F74831","trandate":"03\/27\/2014","taxtotal":3.96,"taxrate":6,"shippingcost":0,"handlingcost":0,"discounttotal":0,"total":69.96,"pnrefnum":false,"paymentmethod":"","item":[{"shipmethod":10,"description":"Orange Shadowbox Polaroid 3.5 x 4.25","item":1197,"quantity":6,"rate":11,"subtotal":66,"custcol_produce_in_store":false,"custcol_store_pickup":false,"discounttotal":0,"location":2}],"shipdate":"04\/01\/2014","customform":129,"ismultishipto":false,"custbody_web_discount_code":""},"customer":{"custentity_customer_source":3,"custentity_customer_source_id":"F73242","firstname":"Jen","lastname":"Stone","email":"roger.williams@successories.com","isperson":true,"custentity_fotomail":"jen73242@myfotobar.com","_source":"Fotobar Store 2","addressee":"","custentitycustomer_department":2}}';

	// Buy GC
	//$sJson = '{"order":{"_source":"Fotobar Store 2","location":2,"department":2,"leadsource":2,"custbody_order_source":28,"ccprocessor":1,"custbody_order_source_id":"F74831","trandate":"03\/27\/2014","taxtotal":3.96,"taxrate":6,"shippingcost":0,"handlingcost":0,"discounttotal":0,"total":69.96,"pnrefnum":false,"paymentmethod":"","item":[{"giftcertrecipientname":"Roger Willliams","giftcertrecipientemail":"roger.williams@successories.com","giftcertnumber":"ROGERTEST","giftcertmessage":"Happy Birthday","giftcertfrom":"Roger Williams","shipmethod":10,"description":"Gift Certificate","item":1119,"quantity":1,"rate":50,"subtotal":50,"custcol_produce_in_store":false,"custcol_store_pickup":false,"discounttotal":0,"location":2},{"shipmethod":10,"description":"Orange Shadowbox Polaroid 3.5 x 4.25","item":1197,"quantity":6,"rate":11,"subtotal":66,"custcol_produce_in_store":true,"custcol_store_pickup":false,"discounttotal":0,"location":2}],"shipdate":"04\/01\/2014","customform":129,"ismultishipto":false,"custbody_web_discount_code":""},"customer":{"custentity_customer_source":3,"custentity_customer_source_id":"F73242","firstname":"Jen","lastname":"Stone","email":"roger.williams@successories.com","isperson":true,"custentity_fotomail":"jen73242@myfotobar.com","_source":"Fotobar Store 2","addressee":"","custentitycustomer_department":2}}';



	$pdo = new PDO('mysql:host='.SYSTEM_DB_HOST.';dbname='.SYSTEM_DB_DATABASE, SYSTEM_DB_USER, SYSTEM_DB_PASS);
	$stmt = $pdo->prepare('INSERT INTO fotobar_order_queue (customer_activa_id, order_activa_id, order_json) VALUES(:customer_activa_id, :order_activa_id, :order_json)');
	//$stmt->execute( array('customer_activa_id' => $aOrderData->customer->custentity_customer_source_id, ':order_activa_id' => $aOrderData->order->custbody_order_source_id, ':order_json' => encrypt( $sJson ) ) );
	$stmt->execute( array('customer_activa_id' => "F".rand(10000,90000), ':order_activa_id' => "FD".rand(10000,90000), ':order_json' => encrypt( $sJson ) ) );

} catch(PDOException $e) {
	echo 'Error: ' . $e->getMessage();
}



function encrypt( $sData ){

	$td = mcrypt_module_open('rijndael-128', '', 'ecb', '');
	$iv = mcrypt_create_iv( mcrypt_enc_get_iv_size( $td ), MCRYPT_RAND );
	$ks = mcrypt_enc_get_key_size( $td );
	$key = substr( md5( SECRET_KEY ), 0, $ks );
	mcrypt_generic_init( $td, $key, $iv );
	$encrypted = mcrypt_generic( $td, $sData );
	mcrypt_generic_deinit( $td );
	mcrypt_module_close( $td );

	return( base64_encode( $encrypted ) );
}

function decrypt( $sData ){

	$td = mcrypt_module_open( 'rijndael-128', '', 'ecb', '' );
	$iv = mcrypt_create_iv(mcrypt_enc_get_iv_size( $td ), MCRYPT_RAND);
	$ks = mcrypt_enc_get_key_size( $td );
	$key = substr( md5( SECRET_KEY ), 0, $ks );

	mcrypt_generic_init( $td, $key, $iv );
	$decrypted = mdecrypt_generic( $td, base64_decode( $sData ) );
	$decrypted = rtrim($decrypted,"\0");
	mcrypt_generic_deinit( $td );
	mcrypt_module_close( $td );

	return( $decrypted );

}

