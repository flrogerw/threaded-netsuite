#!/usr/bin/php
<?php 

require_once( __DIR__ . DIRECTORY_SEPARATOR . 'Configure.php' );


$xxx = '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';
echo(  decrypt(   $xxx  ) );


//$xxx = '{"order":{"_source":"Fotobar","location":1,"department":1,"leadsource":-6,"custbody_order_source":1,"ccprocessor":1,"custbody_order_source_id":"F170426","trandate":"12\/16\/2014","item":[{"addr1":"21411 partha way","city":"Houston","state":"TX","zip":77073,"country":"US","phone":9132212549,"shipmethod":1011,"description":"Clothesline Frame with Clips","item":318,"_fulfilled_by":"0","quantity":1,"custcol_page_count":1,"rate":50,"subtotal":50,"custcol_produce_in_store":false,"custcol_store_pickup":false,"discounttotal":0,"location":1,"attention":"Gia Beaver","addressee":"\'Cake\' by Gia Genea","isresidential":false},{"addr1":"21411 partha way","city":"Houston","state":"TX","zip":77073,"country":"US","phone":9132212549,"shipmethod":1011,"description":"Polaroid 3.5 x 4.25","item":1150,"_fulfilled_by":10,"quantity":19,"custcol_page_count":19,"custcol_image_url":"http:\/\/www.polaroidfotobar.com\/pdf\/170426\/1042956\/5ad214d3\/1042956.pdf","rate":1,"subtotal":19,"custcol_produce_in_store":false,"custcol_store_pickup":false,"discounttotal":0,"location":10,"attention":"Gia Beaver","addressee":"\'Cake\' by Gia Genea","isresidential":false}],"taxtotal":"0.00","taxrate":"0","shippingcost":14.95,"handlingcost":"0","discounttotal":"0","total":83.95,"pnrefnum":"4187563090670176327037","authcode":810200,"paymentmethod":4,"ccname":"Gia Beaver","ccnumber":"5581588946234317","_gcamount":"0","ismultishipto":false,"shipmethod":1011,"shipaddress":"Gia Beaver\n\'Cake\' by Gia Genea\n21411 partha way\nHouston TX 77073","ccexpiredate":"07\/2015","cczipcode":77073,"shipdate":"12\/19\/2014","customform":107,"billaddress":"\'Cake\' by Gia Genea\n\'Cake\' by Gia Genea\n21411 partha way\nHouston TX 77073","custbody_web_discount_code":""},"customer":{"custentity_customer_source":1,"custentity_customer_source_id":"F151944","firstname":"Gia","lastname":"Beaver","email":"Gia.Genea@gmail.com","isperson":true,"custentity_fotomail":"gia151944@myfotobar.com","addressbook":{"billing":{"companyname":"\'Cake\' by Gia Genea","addr1":"21411 partha way","city":"Houston","state":"TX","zip":77073,"country":"US","phone":9132212549,"addressee":"\'Cake\' by Gia Genea","isresidential":false}},"_source":"Fotobar","custentitycustomer_department":1}}';
//echo( encrypt($xxx));
die();

try{

	/** FIXES
	 Removed:
	 Backslashes from dates
	 "_itemlocation":"corporate"

	*/

	//Use GC
	//$sJson = '{"order":{"_source":"Fotobar Store 2","giftcertificateitem":[{"giftcertcode":"store405"}],"location":2,"department":2,"leadsource":2,"custbody_order_source":28,"ccprocessor":1,"custbody_order_source_id":"F74831","trandate":"03\/27\/2014","taxtotal":3.96,"taxrate":6,"shippingcost":0,"handlingcost":0,"discounttotal":0,"total":69.96,"pnrefnum":false,"paymentmethod":"","item":[{"shipmethod":10,"description":"Orange Shadowbox Polaroid 3.5 x 4.25","item":1197,"quantity":6,"rate":11,"subtotal":66,"custcol_produce_in_store":false,"custcol_store_pickup":false,"discounttotal":0,"location":2}],"shipdate":"04\/01\/2014","customform":129,"ismultishipto":false,"custbody_web_discount_code":""},"customer":{"custentity_customer_source":3,"custentity_customer_source_id":"F73242","firstname":"Jen","lastname":"Stone","email":"roger.williams@successories.com","isperson":true,"custentity_fotomail":"jen73242@myfotobar.com","_source":"Fotobar Store 2","addressee":"","custentitycustomer_department":2}}';

	// Buy GC
	//$sJson = '{"order":{"_source":"Fotobar Store 2","location":2,"department":2,"leadsource":2,"custbody_order_source":28,"ccprocessor":1,"custbody_order_source_id":"F74831","trandate":"03\/27\/2014","taxtotal":3.96,"taxrate":6,"shippingcost":0,"handlingcost":0,"discounttotal":0,"total":69.96,"pnrefnum":false,"paymentmethod":"","item":[{"giftcertrecipientname":"Roger Willliams","giftcertrecipientemail":"roger.williams@successories.com","giftcertnumber":"ROGERTEST","giftcertmessage":"Happy Birthday","giftcertfrom":"Roger Williams","shipmethod":10,"description":"Gift Certificate","item":1119,"quantity":1,"rate":50,"subtotal":50,"custcol_produce_in_store":false,"custcol_store_pickup":false,"discounttotal":0,"location":2},{"shipmethod":10,"description":"Orange Shadowbox Polaroid 3.5 x 4.25","item":1197,"quantity":6,"rate":11,"subtotal":66,"custcol_produce_in_store":true,"custcol_store_pickup":false,"discounttotal":0,"location":2}],"shipdate":"04\/01\/2014","customform":129,"ismultishipto":false,"custbody_web_discount_code":""},"customer":{"custentity_customer_source":3,"custentity_customer_source_id":"F73242","firstname":"Jen","lastname":"Stone","email":"roger.williams@successories.com","isperson":true,"custentity_fotomail":"jen73242@myfotobar.com","_source":"Fotobar Store 2","addressee":"","custentitycustomer_department":2}}';



	$pdo = new PDO('mysql:host='.SYSTEM_DB_HOST.';dbname='.SYSTEM_DB_DATABASE, SYSTEM_DB_USER, SYSTEM_DB_PASS);
	$stmt = $pdo->prepare('INSERT INTO fotobar_order_queue (customer_activa_id, order_activa_id, order_json) VALUES(:customer_activa_id, :order_activa_id, :order_json)');
	//$stmt->execute( array('customer_activa_id' => $aOrderData->customer->custentity_customer_source_id, ':order_activa_id' => $aOrderData->order->custbody_order_source_id, ':order_json' => encrypt( $sJson ) ) );
	$stmt->execute( array('customer_activa_id' => "F".rand(10000,90000), ':order_activa_id' => "FD".rand(10000,90000), ':order_json' => encrypt( $sJson ) ) );

} catch(PDOException $e) {
	echo 'Error: ' . $e->getMessage();
}



function encrypt( $sData ){

	$td = mcrypt_module_open('rijndael-128', '', 'ecb', '');
	$iv = mcrypt_create_iv( mcrypt_enc_get_iv_size( $td ), MCRYPT_RAND );
	$ks = mcrypt_enc_get_key_size( $td );
	$key = substr( md5( SECRET_KEY ), 0, $ks );
	mcrypt_generic_init( $td, $key, $iv );
	$encrypted = mcrypt_generic( $td, $sData );
	mcrypt_generic_deinit( $td );
	mcrypt_module_close( $td );

	return( base64_encode( $encrypted ) );
}

function decrypt( $sData ){

	$td = mcrypt_module_open( 'rijndael-128', '', 'ecb', '' );
	$iv = mcrypt_create_iv(mcrypt_enc_get_iv_size( $td ), MCRYPT_RAND);
	$ks = mcrypt_enc_get_key_size( $td );
	$key = substr( md5( SECRET_KEY ), 0, $ks );

	mcrypt_generic_init( $td, $key, $iv );
	$decrypted = mdecrypt_generic( $td, base64_decode( $sData ) );
	$decrypted = rtrim($decrypted,"\0");
	mcrypt_generic_deinit( $td );
	mcrypt_module_close( $td );

	return( $decrypted );

}

